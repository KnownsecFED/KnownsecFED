webpackJsonp([0x95bc1489e7fc],{583:function(n,s){n.exports={data:{site:{siteMetadata:{title:"KnownsecFED",author:"304 Team",siteUrl:"https://knownsec-fed.com"}},markdownRemark:{id:"/tmp/app/src/pages/2018-03-07-fan-yi-ji-yu-cypress-ce-shi-react-ying-yong/index.md absPath of file >>> MarkdownRemark",html:'<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/header-d7343fcc2f16967864203ae4485571ab-d6978.jpeg"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 1200px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFA//EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAGyrnPS0KB//8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAAxIRE//aAAgBAQABBQIqCG86zjs00vJ0rNz/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAACAgMBAAAAAAAAAAAAAAAAAQIyESExUf/aAAgBAQAGPwLGhRl5nhVFmLbLM//EABwQAQACAgMBAAAAAAAAAAAAAAEAETFRIWHR4f/aAAgBAQABPyFzQaaxEk2vJSZl64/Yi3bK3PdJ/9oADAMBAAIAAwAAABBc/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAREP/aAAgBAwEBPxAZ/8QAFREBAQAAAAAAAAAAAAAAAAAAEQD/2gAIAQIBAT8QSb//xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhMWFRkf/aAAgBAQABPxChNrAr6ByKlVtoQfDsAgBdcafeQ91+uOJBAqvsRpdeuf/Z\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="【翻译】基于 Cypress 测试 React 应用"\n        title=""\n        src="/static/header-d7343fcc2f16967864203ae4485571ab-d6978.jpeg"\n        srcset="/static/header-d7343fcc2f16967864203ae4485571ab-527f0.jpeg 300w,\n/static/header-d7343fcc2f16967864203ae4485571ab-9a7cd.jpeg 600w,\n/static/header-d7343fcc2f16967864203ae4485571ab-d6978.jpeg 1200w"\n        sizes="(max-width: 1200px) 100vw, 1200px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>原文链接：<a href="https://blog.callstack.io/testing-react-app-with-cypress-246a7732ee63">Testing React app with Cypress</a></p>\n<p>作者：<a href="https://twitter.com/adam_Trzc">Adam Trzciński</a></p>\n<p>两周(原文发布于2017/11/6)以前，Cypress 开源了并且适用于任何人。</p>\n<p>Cypress 是一个工具，它使得你的端对端测试写起来更快。</p>\n<blockquote>\n<p>对浏览器中运行的任何内容进行快速，简单和可靠的测试。</p>\n</blockquote>\n<p>让我们来试一试，并验证这是真的！</p>\n<p>我们将把 Cypress 与我们的项目之一—<code>Eedi</code> 集成在一起。 <code>Eedi</code> 是英国教师、学生及家长的绝佳教育平台。关键是，任何使用它的人，在浏览时都有愉快而流畅的体验，并且所有的功能都能按预期工作。</p>\n<h2>配置</h2>\n<p>在我们应用程序的根目录下，让我们添加 Cypress 作为 dev 依赖。</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ yarn add --dev cypress</code></pre>\n      </div>\n<p>调整 <code>package.json</code> 中的 “scripts”:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n   <span class="token operator">...</span>\n   <span class="token string">"cypress:open"</span><span class="token punctuation">:</span> <span class="token string">"cypress open"</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>就像正常开发一样，在本地运行服务，然后在新的终端窗口中打开 Cypress:</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>$ yarn run cypress:open</code></pre>\n      </div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/one-9808590923b1b9e5f35147df7f15e7be-93f87.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 1147px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 64.25457715780297%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAAvUlEQVQoz+2Ryw6CMBBF+7fAQig+qBj1n5QUBV3QypZIAfkUSS0PB01cGDew9uZkctPJySyKyMyeExdjgrED2FMCGIalaRPdMDXN7ItuWnjxXgEOWZPlZuVu0W5PPY9SejgGYRCeGbtEEYfJeMxY3M9XgccPnMd+eKJ+gKpK3iupVNMNzEPVSCnVtl3bZ5gMYi93o/KXR8hSSvilZmBAARFBG3e5rmuUJFeR5mmafZFleVGUxa0U2Y+tEDmIT17EzEGk+E/vAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="one"\n        title=""\n        src="/static/one-9808590923b1b9e5f35147df7f15e7be-93f87.png"\n        srcset="/static/one-9808590923b1b9e5f35147df7f15e7be-1acea.png 300w,\n/static/one-9808590923b1b9e5f35147df7f15e7be-0e8cc.png 600w,\n/static/one-9808590923b1b9e5f35147df7f15e7be-93f87.png 1147w"\n        sizes="(max-width: 1147px) 100vw, 1147px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>过了一会儿，Cypress 应该打开了，我们应该看到一个窗口弹出。</p>\n<p>在这里，我们可以访问我们所有的测试，甚至开箱即用。</p>\n<p>Cypress 已创建新的文件夹<code>cypress</code> 与子文件夹 <code>fixtures</code>, <code>integration</code>和<code>support</code>。它还添加了一个空配置文件<code>cypress.json</code>。</p>\n<p>由于我们经常访问我们的根路径，因此将它抽象为配置文件是一种很好的做法。打开<code>cypress.json</code>文件，并添加一个带有键<code>baseUrl</code>和 url 的新条目作为值:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token punctuation">{</span>\n  <span class="token string">"baseUrl"</span><span class="token punctuation">:</span> <span class="token string">"http://localhost:3000"</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>在<code>example_spec.js</code>文件中，我们可以看到’Kitchen Sink Tests’，当我们想要浏览一些常见的测试场景时可以派上用场。但是让我们现在写我们自己的测试。</p>\n<h2>测试登录</h2>\n<p>登录是任何应用程序最重要的功能之一。如果做得不好，用户将无法看到我们其它的工作，并且再做其他事情就没有任何意义。</p>\n<p>创建一个新文件<code>login_spec.js</code>。在这里，我们将测试我们关于登录的所有逻辑。</p>\n<p>让我们写下我们的第一个测试，让我们来检查一下 happy path 是否如预期一样工作：</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">\'Log In\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">\'succesfully performs login action\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 访问 \'baseUrl\'</span>\n    cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">\'/\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 断言我们是否处于好的位置 - 搜索\'smarter world\'</span>\n    cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">\'smarter world\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 搜索带有 \'Teachers\' 的div, 并点击它</span>\n    cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'a[data-testid="main-link-teachers"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 检查url是否改变</span>\n    cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">\'includes\'</span><span class="token punctuation">,</span> <span class="token string">\'teachers\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">\'more time to teach\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 找到Login按钮并点击它</span>\n    cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'button[data-testid="menu-button-login"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 检查url是否改变</span>\n    cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">\'includes\'</span><span class="token punctuation">,</span> <span class="token string">\'/login\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 提交输入表单并点击提交按钮</span>\n    cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'input[data-testid="login-form-username"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">\'test@email.com\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'input[data-testid="login-form-password"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">\'password\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'button[data-testid="login-form-submit"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 验证是否被重定向</span>\n    cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">{</span> timeout<span class="token punctuation">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">\'includes\'</span><span class="token punctuation">,</span> <span class="token string">\'/c/\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>现在，请转到 Cypress 应用程序并选择我们刚刚创建的测试。它应该在一个文件中运行所有的测试，我们可以看到它们的表现如何：</p>\n<p><img src="/two-16287261e66e2b1c8ecbc30283ebc238.gif" alt="two"></p>\n<p>在测试运行器的左侧窗格中，我们可以看到 Cypress 执行的所有操作，查找到的元素以及浏览器重定向的元素。我们还可以使用漂亮的时间旅行功能，并检查我们测试的每一步。</p>\n<p>让我们停下来！修改测试的第12行：</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code>cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">\'Log In\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre>\n      </div>\n<p><img src="/three-40cd3a8174ad86ccd75ba4978d6270be.gif" alt="three"></p>\n<p>它失败了。这很好，我们已经确定 happy path 确实很 happy。Cypress 为我们提供了详细的堆栈跟踪 — 发生了什么问题以及在哪里发生的问题。</p>\n<p>添加更多的用例:</p>\n<ul>\n<li>不成功的登录操作应该会产生错误消息</li>\n<li>未经授权的用户应该无法访问受限制的网址</li>\n</ul>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">\'Log In\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">\'succesfully performs login action\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token operator">...</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">\'displays error message when login fails\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 直接转到登录路径</span>\n    cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">\'/login\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 尝试使用不正确的凭证登录</span>\n    cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'input[data-testid="login-form-username"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">\'test@email.com\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'input[data-testid="login-form-password"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">\'fail_password\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'button[data-testid="login-form-submit"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 应该出现错误信息</span>\n    cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">\'Something went wrong\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">\'redirects unauthorized users\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 转到受保护的路径</span>\n    cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">\'/c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 应该重定向到登录页面</span>\n    cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">\'contains\'</span><span class="token punctuation">,</span> <span class="token string">\'/login\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>我们保存测试文件之后，Cypress应该重新运行所有的测试：</p>\n<p><img src="/four-f844f2b4fc8de8453cd52d56ea490fb4.gif" alt="four"></p>\n<h2>测试注销</h2>\n<p>下一个要覆盖的功能是注销操作。我们希望确定该用户可以正确地从我们的应用程序注销。听起来很简单，对吧？</p>\n<p>但是，让我们再考虑一下…为了注销，我们需要先登录，对吧？我们是否应该重用先前测试的代码，然后再添加更多逻辑？听起来很傻，我们是开发者，我们可以做得更好！</p>\n<p>Cypress 提供了另一个便利的功能 — 命令。它允许我们创建可以在任何测试中重用的自定义操作。而且由于大多数场景应该为登录用户编写，因此此操作是自定义命令的完美候选。</p>\n<p>打开位于<code>support</code>文件夹中的<code>commands.js</code>文件。 Cypress 为我们提供了一些示例，取消注释即可使用！</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token comment">// -- This is a parent command --</span>\n<span class="token comment">// Cypress.Commands.add("login", (email, password) => { ... })</span>\n<span class="token comment">//</span>\n</code></pre>\n      </div>\n<p>使用我们的自定义行为来增强此登录命令，但首先让我们考虑一下我们想要做什么。</p>\n<p>我们已经测试了登录，不是吗？所以，我们接下来要写的每一个测试都是重复相同的步骤，是没有意义的。我们甚至可以阅读<a href="https://docs.cypress.io/guides/getting-started/testing-your-app.html#Logging-In">文档</a>：</p>\n<blockquote>\n<p>完全测试登录流程 - 但只有一次！</p>\n</blockquote>\n<p>同样的：</p>\n<blockquote>\n<p>在每次测试之前，请勿使用您的用户界面登录。</p>\n</blockquote>\n<p>那我们能做什么呢？</p>\n<p>我们可以使用<code>cy.request()</code>直接向我们的后端服务请求登录，然后像往常一样继续。如下：</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code>Cypress<span class="token punctuation">.</span>Commands<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'login\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// 向后端发出POST请求</span>\n  <span class="token comment">// 我们正在使用GraphQL，因此我们正在通过转变:</span>\n  cy\n    <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      url<span class="token punctuation">:</span> <span class="token string">\'http://localhost:4000/graphql\'</span><span class="token punctuation">,</span>\n      method<span class="token punctuation">:</span> <span class="token string">\'POST\'</span><span class="token punctuation">,</span>\n      body<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        query<span class="token punctuation">:</span>\n          <span class="token string">\'mutation login($email: String!, $password: String!) {loginUser(email: $email, password: $password)}\'</span><span class="token punctuation">,</span>\n        variables<span class="token punctuation">:</span> <span class="token punctuation">{</span> email<span class="token punctuation">,</span> password <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resp <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 断言来自服务器的响应</span>\n      <span class="token function">expect</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">expect</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>have<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 我们所有的private路径都会检查存在redux store上的auth token,所以让我们把它传递到那里</span>\n      window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>\n        <span class="token string">\'reduxPersist:user\'</span><span class="token punctuation">,</span>\n        JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> refreshToken<span class="token punctuation">:</span> resp<span class="token punctuation">.</span>body<span class="token punctuation">.</span>data<span class="token punctuation">.</span>loginUser <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 到仪表盘</span>\n      cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">\'/c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>现在，在每个测试中，我们可以调用<code>cy.login（\'username\'，\'password\'）</code>，并且它应该执行登录操作而不需要使用UI。</p>\n<p>现在我们准备测试注销操作，创建<code>logout_spec.js</code>并添加一些断言：</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token keyword">const</span> baseUrlMatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">\'localhost:3000/$\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">\'Log out user properly\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// 在每次测试前登录:</span>\n  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    cy<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">\'test@email.com\'</span><span class="token punctuation">,</span> <span class="token string">\'password\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">\'can select dropdown and perform logout action\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 检查我们是否登录:</span>\n    cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">\'contains\'</span><span class="token punctuation">,</span> <span class="token string">\'/c/\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'div[data-testid="main-menu-settings"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy\n      <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'.Popover-body ul li\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">\'match\'</span><span class="token punctuation">,</span> baseUrlMatcher<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">\'/logout url should work as well\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">\'contains\'</span><span class="token punctuation">,</span> <span class="token string">\'/c/\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">\'/log-out\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">\'match\'</span><span class="token punctuation">,</span> baseUrlMatcher<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">\'should clear auth token from local storage\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">\'contains\'</span><span class="token punctuation">,</span> <span class="token string">\'/c/\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">\'/logout\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">\'match\'</span><span class="token punctuation">,</span> baseUrlMatcher<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> user <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">\'reduxPersist:user\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    assert<span class="token punctuation">.</span><span class="token function">isUndefined</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>token<span class="token punctuation">,</span> <span class="token string">\'refreshToken is undefined\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>观察它们失败：</p>\n<p><img src="/five-ae7b3cf4dc7ee6dcf728982cda4f057b.gif" alt="five"></p>\n<p>然后修改第14行和第20行（将<code>first()</code>更改为<code>last()</code>，将<code>cy.visit(\'log-out\')</code>更改为<code>cy.visit(\'logout\')</code>并观察测试如何通过:</p>\n<p><img src="/six-b76faf266822ed0723117fad901929b5.gif" alt="six"></p>\n<h2>TL;DR</h2>\n<p>总之，用 Cypress 写测试真的很有趣。</p>\n<p>正如所宣称的，配置几乎为零，编写断言很简单，感觉很自然，而且 GUI 非常棒！您可以进行时间旅行，调试所有步骤，并且因为它们都作为 Electron 应用程序启动，所以我们甚至可以访问开发者工具以了解每个动作发生了什么。</p>\n<blockquote>\n<p>网络已经进化，测试依旧会如此。</p>\n</blockquote>\n<p>让我们写一些测试吧，愿原力与你同在！</p>',
fields:{slug:"/2018-03-07-fan-yi-ji-yu-cypress-ce-shi-react-ying-yong/"},frontmatter:{title:"【翻译】基于 Cypress 测试 React 应用",date:"2018-03-07",catalog:"前端",author:"RUUR"}},allMarkdownRemark:{edges:[{node:{fields:{slug:"/2018-03-19-fan-yi-shi-yong-de-ui-dong-hua-ji-qiao-gai-jin-ui-wei-jiao-hu-de-shi-yong-jian-yi/"},frontmatter:{title:"【翻译】实用的 UI 动画技巧——改进 UI 微交互的实用建议"}}},{node:{fields:{slug:"/2018-03-19-reactref-zhi-bei-jiao-cheng/"},frontmatter:{title:"React ref 指北教程"}}},{node:{fields:{slug:"/2018-03-18-fan-yi-how-to-prevent-your-node.js-process-from-crashing/"},frontmatter:{title:"【翻译】 如何使你的 Node 应用免于崩溃"}}},{node:{fields:{slug:"/2018-03-17-yi-zhong-qian-hou-duan-fen-li-de-kua-yu-kai-fa-fang-shi/"},frontmatter:{title:"一种方便的跨域开发解决方案"}}},{node:{fields:{slug:"/2018-03-13-fan-yi-ru-he-chuang-jian-jiao-hu-you-hao-de-biao-dan/"},frontmatter:{title:"【翻译】如何创建交互友好的表单"}}},{node:{fields:{slug:"/2018-03-12-fan-yi-rang-wo-men-cong-ling-kai-shi-bian-bian-xie-yi-ge-web-fu-wu-qi/"},frontmatter:{title:"【翻译】让我们从零开始变编写一个web服务器"}}},{node:{fields:{slug:"/2018-03-11-bikeshedding/"},frontmatter:{title:"由屎色自行车棚引发的思考"}}},{node:{fields:{slug:"/2018-03-11-xin-shou-shi-jiao-de-docker/"},frontmatter:{title:"新手视角的 Docker"}}},{node:{fields:{slug:"/2018-03-07-fan-yi-ji-yu-cypress-ce-shi-react-ying-yong/"},frontmatter:{title:"【翻译】基于 Cypress 测试 React 应用"}}},{node:{fields:{slug:"/2018-03-05-fan-yi-ru-he-zhao-dao-wan-mei-de-se-cai-da-pei-jie-shao-colorclaim/"},frontmatter:{title:"【翻译】如何找到完美的色彩搭配 - 介绍 ColorClaim"}}},{node:{fields:{slug:"/2018-03-05-ru-he-shi-yong-mac-po-jie-wifi/"},frontmatter:{title:"如何使用Mac破解Wifi"}}},{node:{fields:{slug:"/2018-03-05-yi-ge-chrome-kuo-zhan-jiu-zhe-yang-dan-sheng-liao/"},frontmatter:{title:"程序员偷懒指南 -- 用chrome插件实现前端资讯推送"}}},{node:{fields:{slug:"/2018-03-01-wei-xian-de-targetblank-yu-opener/"},frontmatter:{title:'危险的 target="_blank" 与 “opener”'}}},{node:{fields:{slug:"/2018-02-28-activerecord-he-datamappers-mo-shi-jian-jie/"},frontmatter:{title:"Active Record 和 Data Mappers 模式简介"}}},{node:{fields:{slug:"/2018-02-26-bu-jin-jin-shi-piao-liang-tu-xiang-ru-he-qu-dong-yong-hu-ti-yan/"},frontmatter:{title:"【翻译】不仅仅是漂亮：图像如何驱动用户体验"}}},{node:{fields:{slug:"/2018-02-23-css3-clip-path-yong-fa-jie-shao/"},frontmatter:{title:"CSS3 clip-path 用法介绍"}}},{node:{fields:{slug:"/2018-02-23-du-shu-bi-ji-ke-shi-hua-shi-yi-zhong-yi-shu-bu-zhi-shi-mei-xin-xi-tu-biao-she-ji-yuan-li-yu-jing-dian-an-li-xu-zhang/"},frontmatter:{title:"读书笔记：可视化是一种艺术 -《不只是美：信息图表设计原理与经典案例》序章"}}},{node:{fields:{slug:"/2018-02-23-mei-ge-node-ying-yong-ke-neng-cun-zai-de-timing-attack-an-quan-lou-dong/"},frontmatter:{title:"每个 node 应用可能存在的 timing-attack 安全漏洞"}}},{node:{fields:{slug:"/2018-02-09-zan-lai-liao-liao-vuecompile/"},frontmatter:{title:"咱来聊聊 Vue - compile"}}},{node:{fields:{slug:"/2018-02-05-ji-yi-ci-jian-dan-de-csrf-gong-ji-shi-yan/"},frontmatter:{title:"记一次简单的 CSRF 攻击实验"}}},{node:{fields:{slug:"/2018-02-04-fan-yi-reactscope-jie-shao/"},frontmatter:{title:"【翻译】React Scope介绍"}}},{node:{fields:{slug:"/2018-02-03-fan-yi-liu-ge-xuan-ze-ui-yan-se-de-ji-qiao/"},frontmatter:{title:"【翻译】六个选择UI颜色的技巧"}}},{node:{fields:{slug:"/2018-02-03-huo-yong-git-apply-he-ru-patch-bu-ding/"},frontmatter:{title:"活用 git apply 合入 patch 补丁"}}},{node:{fields:{slug:"/2018-02-03-wo-de-di-yi-ge-node-ming-ling-hang-gong-ju/"},frontmatter:{title:"我的第一个 Node 命令行工具"}}},{node:{fields:{slug:"/2018-02-01-fan-yi-react-xin-de-contextapi/"},frontmatter:{title:"【翻译】React ⚛️  新的 Context API"}}},{node:{fields:{slug:"/2018-01-29-kuai-su-da-jian-ni-de-github-page-ge-ren-bo-ke-ji-yu-createreactapp-de-dan-ye-mian-ying-yong-shi-jian/"},frontmatter:{title:"快速搭建你的 github pages 个人博客 —— 基于 Create-React-App 的单页面应用实践"}}},{node:{fields:{slug:"/2018-01-28-redux-promise-middleware/"},frontmatter:{title:"一个插件让你在 Redux 中写 promise 事半功倍"}}},{node:{fields:{slug:"/2018-01-28-fan-yi-react-zu-jian-mo-shi/"},frontmatter:{title:"【翻译】React 组件设计模式基础"}}},{node:{fields:{slug:"/2018-01-28-fan-yi-bu-yao-rang-yong-hu-zai-chan-pin-ti-yan-shang-shou-dao-cuo-zhe/"},frontmatter:{title:"【翻译】不要让用户在产品体验上受到挫折"}}},{node:{fields:{slug:"/2018-01-27-javascript-mo-huan-dai-li/"},frontmatter:{title:"JavaScript 魔幻代理"}}},{node:{fields:{slug:"/2018-01-22-web-qian-duan-jian-dan-ding-yue-de-shi-xian/"},frontmatter:{title:"Web前端简单订阅的实现"}}},{node:{fields:{slug:"/2018-01-21-how-django-works/"},frontmatter:{title:"从请求到响应 django 都做了哪些处理"}}},{node:{fields:{slug:"/2018-01-21-electron-with-react/"},frontmatter:{title:"React+Electron搭建一个桌面应用"}}},{node:{fields:{slug:"/2018-01-20-fan-yi-ui-she-ji-zhong-de-ge-shi-ta-yuan-ze/"},frontmatter:{title:"【翻译】UI 设计中的格式塔原则"}}},{node:{fields:{slug:"/2018-01-19-xia-yi-dai-tong-xin-xie-yi-quic/"},frontmatter:{title:"下一代通信协议：QUIC"}}},{node:{fields:{slug:"/2018-01-19-fan-yi-shi-yong-css-zhui-zong-yong-hu/"},frontmatter:{title:"【翻译】使用 CSS 追踪用户"}}},{node:{fields:{slug:"/2018-01-14-antd-yuan-ma-jie-du-notification/"},frontmatter:{title:"antd 源码解读 notification"}}},{node:{fields:{slug:"/2018-01-14-ui-zhong-de-pai-ban-chu-xue-zhe-zhi-nan/"},frontmatter:{title:"【翻译】UI 中的排版：初学者指南"}}},{node:{fields:{slug:"/2018-01-14-learn-koa-intro/"},frontmatter:{title:"koa包教包会(一)--白话koa"}}},{node:{fields:{slug:"/2018-01-13-zi-ji-dong-shou-xie-yi-ge-simplevue/"},frontmatter:{title:"自己动手写一个 SimpleVue"}}},{node:{fields:{slug:"/2018-01-12-translation-React-Animations-in-Depth/"},frontmatter:{title:"【翻译】React Web 动画的 5 种创建方式，每一种都不简单"}}},{node:{fields:{slug:"/2018-01-10-ru-he-kuo-zhan-create-react-app-de-webpack-pei-zhi/"},frontmatter:{title:"如何扩展 Create React App 的 Webpack 配置"}}},{node:{fields:{slug:"/2018-01-08-mapbox-gl-js/"},frontmatter:{title:"3D GIS 应用开发 —— 基于 Mapbox GL 的实践总结"}}},{node:{fields:{slug:"/2018-01-07-the-importance-of-visual-appeal-in-web-design/"},frontmatter:{title:"【翻译】视觉吸引力在网页设计中的重要性"}}},{node:{fields:{slug:"/2018-01-06-react-higher-order-component/"},frontmatter:{title:"React 高阶组件介绍"}}},{node:{fields:{slug:"/2018-01-05-to-vim/"},frontmatter:{title:"如何让 vim 成为我们的神器"}}},{node:{fields:{slug:"/2018-01-05-d3-js-v3-data-driven-and-d3-force/"},frontmatter:{title:"D3.js 数据驱动 和 force 力学图讲解"}}},{node:{fields:{slug:"/2018-01-05-create-a-redux-middleware/"},frontmatter:{title:"如何编写一个 Redux 中间件"}}}]}},pathContext:{slug:"/2018-03-07-fan-yi-ji-yu-cypress-ce-shi-react-ying-yong/"}}}});
//# sourceMappingURL=path---2018-03-07-fan-yi-ji-yu-cypress-ce-shi-react-ying-yong-882e72b36d9f3a06d8b5.js.map